<link rel="stylesheet" href="/css/modern-table.css"><link rel="stylesheet" href="/css/modern-table.css"><div class="container-fluid">

<link rel="stylesheet" href="/css/users.css">

    <div class="row mb-4">

<!-- Page Header -->

<div class="content-header"><div class="container-fluid">        <div class="col">

    <div>

        <h1 class="page-title">    <!-- Header -->            <h2 class="page-title">

            <i class="fas fa-users-cog"></i>

            Quản lý tài khoản admin & phân quyền    <div class="row mb-4">                <i class="fas fa-user-cog me-2"></i>

        </h1>

        <p class="page-subtitle">        <div class="col">                Quản lý Người dùng

            <i class="fas fa-shield-alt"></i>

            Quản lý tài khoản người dùng, phân quyền và vai trò            <h2 class="page-title">            </h2>

        </p>

    </div>                <i class="fas fa-user-cog me-2"></i>            <p class="text-muted">Quản lý tài khoản người dùng, phân quyền và trạng thái</p>

    <div class="content-actions">

        <button class="btn-modern btn-modern-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">                Quản lý Người dùng        </div>

            <i class="fas fa-plus"></i>

            Thêm admin            </h2>        <div class="col-auto">

        </button>

    </div>            <p class="text-muted">Quản lý tài khoản người dùng, phân quyền và trạng thái</p>            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">

</div>

        </div>                <i class="fas fa-plus me-2"></i>Thêm người dùng

<!-- Tab Navigation -->

<div class="users-tabs">        <div class="col-auto">            </button>

    <button class="users-tab-btn active" data-tab="users">

        <i class="fas fa-users"></i>            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">        </div>

        Tài khoản

    </button>                <i class="fas fa-plus me-2"></i>Thêm người dùng    </div>

    <button class="users-tab-btn" data-tab="roles">

        <i class="fas fa-user-shield"></i>            </button>

        Role & Quyền

    </button>        </div>    <!-- Statistics Cards -->

</div>

    </div>    <div class="row g-3 mb-4">

<!-- Users Tab Content -->

<div class="tab-content active" id="usersTab">        <div class="col-md-3">

    <div class="modern-table-container">

        <!-- Filter Bar -->    <!-- Statistics Cards -->            <div class="card stat-card stat-card-primary">

        <div class="table-filter-bar">

            <div class="users-status-filters">    <div class="row g-3 mb-4">                <div class="card-body">

                <button class="filter-btn active" data-status="all">

                    Tất cả        <div class="col-md-3">                    <div class="d-flex justify-content-between align-items-center">

                </button>

                <button class="filter-btn" data-status="active">            <div class="card stat-card stat-card-primary">                        <div>

                    <i class="fas fa-check-circle"></i>

                    Đang hoạt động                <div class="card-body">                            <p class="text-muted mb-1">Tổng người dùng</p>

                </button>

                <button class="filter-btn" data-status="inactive">                    <div class="d-flex justify-content-between align-items-center">                            <h3 class="mb-0">{{stats.totalUsers}}</h3>

                    <i class="fas fa-ban"></i>

                    Tạm khóa                        <div>                            <small class="text-muted">Đã đăng ký</small>

                </button>

            </div>                            <p class="text-muted mb-1">Tổng người dùng</p>                        </div>

            

            <div class="filter-search-box">                            <h3 class="mb-0">{{stats.totalUsers}}</h3>                        <div class="stat-icon bg-primary">

                <i class="fas fa-search"></i>

                <input type="text" id="userSearch" placeholder="Tìm kiếm theo tên, email, role">                            <small class="text-muted">Đã đăng ký</small>                            <i class="fas fa-users"></i>

            </div>

        </div>                        </div>                        </div>



        <!-- Users Table -->                        <div class="stat-icon bg-primary">                    </div>

        <div class="table-responsive">

            <table class="modern-table">                            <i class="fas fa-users"></i>                </div>

                <thead>

                    <tr>                        </div>            </div>

                        <th class="sortable" data-sort="name">

                            <i class="fas fa-sort"></i>                    </div>        </div>

                            Tên

                        </th>                </div>        <div class="col-md-3">

                        <th class="sortable" data-sort="email">

                            <i class="fas fa-sort"></i>            </div>            <div class="card stat-card stat-card-success">

                            Email

                        </th>        </div>                <div class="card-body">

                        <th class="sortable" data-sort="phone">

                            <i class="fas fa-sort"></i>        <div class="col-md-3">                    <div class="d-flex justify-content-between align-items-center">

                            Điện thoại

                        </th>            <div class="card stat-card stat-card-success">                        <div>

                        <th class="sortable text-center" data-sort="created">

                            <i class="fas fa-sort"></i>                <div class="card-body">                            <p class="text-muted mb-1">Đang hoạt động</p>

                            Ngày tạo

                        </th>                    <div class="d-flex justify-content-between align-items-center">                            <h3 class="mb-0">{{stats.activeUsers}}</h3>

                        <th class="text-center">

                            Trạng thái                        <div>                            <small class="text-success">Online hiện tại</small>

                        </th>

                        <th class="text-center">                            <p class="text-muted mb-1">Đang hoạt động</p>                        </div>

                            Role

                        </th>                            <h3 class="mb-0">{{stats.activeUsers}}</h3>                        <div class="stat-icon bg-success">

                        <th class="text-center">

                            Thao tác                            <small class="text-success">Online hiện tại</small>                            <i class="fas fa-user-check"></i>

                        </th>

                    </tr>                        </div>                        </div>

                </thead>

                <tbody>                        <div class="stat-icon bg-success">                    </div>

                    {{#each users}}

                    <tr data-user-id="{{Id}}">                            <i class="fas fa-user-check"></i>                </div>

                        <td>

                            <div class="table-cell-icon">                        </div>            </div>

                                <div class="user-avatar">

                                    {{#if Avatar}}                    </div>        </div>

                                    <img src="{{Avatar}}" alt="{{UserName}}">

                                    {{else}}                </div>        <div class="col-md-3">

                                    {{substring UserName 0 1}}

                                    {{/if}}            </div>            <div class="card stat-card stat-card-warning">

                                </div>

                                <span class="table-cell-name">{{UserName}}</span>        </div>                <div class="card-body">

                            </div>

                        </td>        <div class="col-md-3">                    <div class="d-flex justify-content-between align-items-center">

                        <td>

                            <div class="table-cell-email">            <div class="card stat-card stat-card-warning">                        <div>

                                <i class="fas fa-envelope"></i>

                                <span>{{Email}}</span>                <div class="card-body">                            <p class="text-muted mb-1">Quản trị viên</p>

                            </div>

                        </td>                    <div class="d-flex justify-content-between align-items-center">                            <h3 class="mb-0">{{stats.adminUsers}}</h3>

                        <td>

                            <div class="table-cell-phone">                        <div>                            <small class="text-muted">Admin</small>

                                <i class="fas fa-phone"></i>

                                <span>{{#if Phone}}{{Phone}}{{else}}-{{/if}}</span>                            <p class="text-muted mb-1">Quản trị viên</p>                        </div>

                            </div>

                        </td>                            <h3 class="mb-0">{{stats.adminUsers}}</h3>                        <div class="stat-icon bg-warning">

                        <td class="text-center">

                            <span class="table-cell-secondary">{{formatDate CreatedAt}}</span>                            <small class="text-muted">Admin</small>                            <i class="fas fa-user-shield"></i>

                        </td>

                        <td class="text-center">                        </div>                        </div>

                            {{#if IsActive}}

                            <span class="table-status-badge status-success">                        <div class="stat-icon bg-warning">                    </div>

                                <i class="fas fa-check-circle"></i>

                                Đang hoạt động                            <i class="fas fa-user-shield"></i>                </div>

                            </span>

                            {{else}}                        </div>            </div>

                            <span class="table-status-badge status-danger">

                                <i class="fas fa-ban"></i>                    </div>        </div>

                                Tạm khóa

                            </span>                </div>        <div class="col-md-3">

                            {{/if}}

                        </td>            </div>            <div class="card stat-card stat-card-danger">

                        <td class="text-center">

                            {{#if RoleName}}        </div>                <div class="card-body">

                            <span class="user-role-badge role-{{toLowerCase RoleName}}">

                                <i class="fas fa-user-shield"></i>        <div class="col-md-3">                    <div class="d-flex justify-content-between align-items-center">

                                {{RoleName}}

                            </span>            <div class="card stat-card stat-card-danger">                        <div>

                            {{else}}

                            <span class="table-cell-secondary">Chưa có</span>                <div class="card-body">                            <p class="text-muted mb-1">Bị khóa</p>

                            {{/if}}

                        </td>                    <div class="d-flex justify-content-between align-items-center">                            <h3 class="mb-0">{{stats.blockedUsers}}</h3>

                        <td>

                            <div class="table-actions-cell">                        <div>                            <small class="text-danger">Tạm ngưng</small>

                                <button class="table-action-btn action-edit" 

                                        title="Chỉnh sửa"                            <p class="text-muted mb-1">Bị khóa</p>                        </div>

                                        onclick="editUser('{{Id}}')">

                                    <i class="fas fa-edit"></i>                            <h3 class="mb-0">{{stats.blockedUsers}}</h3>                        <div class="stat-icon bg-danger">

                                </button>

                                <button class="table-action-btn action-delete"                             <small class="text-danger">Tạm ngưng</small>                            <i class="fas fa-user-lock"></i>

                                        title="Xóa"

                                        onclick="deleteUser('{{Id}}')">                        </div>                        </div>

                                    <i class="fas fa-trash"></i>

                                </button>                        <div class="stat-icon bg-danger">                    </div>

                            </div>

                        </td>                            <i class="fas fa-user-lock"></i>                </div>

                    </tr>

                    {{/each}}                        </div>            </div>

                </tbody>

            </table>                    </div>        </div>

        </div>

                </div>    </div>

        <!-- Pagination -->

        {{#if pagination}}            </div>

        <div class="table-pagination">

            <div class="pagination-info">        </div>    <!-- Filters -->

                <span>1 - 20 of 66</span>

                <button class="pagination-refresh" onclick="location.reload()">    </div>    <div class="card mb-4">

                    <i class="fas fa-sync-alt"></i>

                </button>        <div class="card-body">

            </div>

            <div class="pagination-controls">    <!-- Modern Table Container -->            <form method="GET" action="/users" class="row g-3">

                <button class="pagination-btn" disabled>

                    <i class="fas fa-chevron-left"></i>    <div class="modern-table-container">                <div class="col-md-3">

                </button>

                <button class="pagination-btn active">1</button>        <!-- Table Header -->                    <label class="form-label">Tìm kiếm</label>

                <button class="pagination-btn">2</button>

                <button class="pagination-btn">3</button>        <div class="table-header-section">                    <input type="text" class="form-control" name="search" 

                <button class="pagination-btn">4</button>

                <button class="pagination-btn">5</button>            <div class="table-title-wrapper">                           placeholder="Tên, email, username..." value="{{search}}">

                <button class="pagination-btn">...</button>

                <button class="pagination-btn">20</button>                <div>                </div>

                <button class="pagination-btn">

                    <i class="fas fa-chevron-right"></i>                    <h2 class="table-title">                <div class="col-md-2">

                </button>

                <select class="pagination-select">                        <i class="fas fa-users" style="color: var(--table-primary);"></i>                    <label class="form-label">Vai trò</label>

                    <option value="20" selected>20 hàng trên trang</option>

                    <option value="50">50 hàng trên trang</option>                        Danh sách người dùng                    <select class="form-select" name="role">

                    <option value="100">100 hàng trên trang</option>

                </select>                    </h2>                        <option value="">Tất cả</option>

            </div>

        </div>                    <p class="table-subtitle">Quản lý và phân quyền người dùng hệ thống</p>                        <option value="Admin" {{#ifEquals role 'Admin'}}selected{{/ifEquals}}>Admin</option>

        {{/if}}

    </div>                </div>                        <option value="User" {{#ifEquals role 'User'}}selected{{/ifEquals}}>User</option>

</div>

            </div>                        <option value="Manager" {{#ifEquals role 'Manager'}}selected{{/ifEquals}}>Manager</option>

<!-- Roles Tab Content -->

<div class="tab-content" id="rolesTab">            <div class="table-actions">                    </select>

    <div class="roles-container">

        <div class="roles-sidebar">                <button class="btn-modern btn-modern-secondary" onclick="exportUsers()">                </div>

            <h3 class="roles-sidebar-title">

                <i class="fas fa-list"></i>                    <i class="fas fa-download"></i>                <div class="col-md-2">

                Danh sách Role

            </h3>                    Xuất Excel                    <label class="form-label">Trạng thái</label>

            <div class="roles-list">

                {{#each roles}}                </button>                    <select class="form-select" name="status">

                <div class="role-item {{#if @first}}active{{/if}}" data-role-id="{{RoleID}}">

                    <div class="role-item-icon">                <button class="btn-modern btn-modern-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">                        <option value="">Tất cả</option>

                        <i class="fas fa-user-shield"></i>

                    </div>                    <i class="fas fa-plus"></i>                        <option value="active" {{#ifEquals status 'active'}}selected{{/ifEquals}}>Hoạt động</option>

                    <div class="role-item-content">

                        <div class="role-item-name">{{RoleName}}</div>                    Thêm người dùng                        <option value="inactive" {{#ifEquals status 'inactive'}}selected{{/ifEquals}}>Không hoạt động</option>

                        <div class="role-item-desc">{{Description}}</div>

                    </div>                </button>                        <option value="blocked" {{#ifEquals status 'blocked'}}selected{{/ifEquals}}>Bị khóa</option>

                </div>

                {{/each}}            </div>                    </select>

            </div>

            <button class="btn-modern btn-modern-primary" data-bs-toggle="modal" data-bs-target="#addRoleModal" style="width: 100%; margin-top: 16px;">        </div>                </div>

                <i class="fas fa-plus"></i>

                Thêm role                <div class="col-md-2">

            </button>

        </div>        <!-- Filter Bar -->                    <label class="form-label">Phòng ban</label>



        <div class="roles-detail">        <div class="table-filter-bar">                    <select class="form-select" name="department">

            <div class="roles-detail-header">

                <div>            <div class="filter-search-box">                        <option value="">Tất cả</option>

                    <h3 class="roles-detail-title" id="currentRoleName">Chủ cửa hàng</h3>

                    <p class="roles-detail-subtitle" id="currentRoleDesc">Toàn quyền hệ thống</p>                <i class="fas fa-search"></i>                        {{#each departments}}

                </div>

                <button class="btn-modern btn-modern-secondary" onclick="editCurrentRole()">                <input type="text" id="tableSearch" name="search" value="{{search}}"                         <option value="{{DepartmentID}}">{{Name}}</option>

                    <i class="fas fa-edit"></i>

                    Chỉnh sửa                       placeholder="Tìm theo tên, email, username...">                        {{/each}}

                </button>

            </div>            </div>                    </select>



            <div class="permissions-grid">                </div>

                <div class="permission-section">

                    <div class="permission-section-header">            <select class="filter-select" id="roleFilter" name="role">                <div class="col-md-3">

                        <i class="fas fa-users"></i>

                        <h4>Người dùng</h4>                <option value="">Tất cả vai trò</option>                    <label class="form-label">&nbsp;</label>

                    </div>

                    <div class="permission-items">                <option value="Admin" {{#ifEquals role 'Admin'}}selected{{/ifEquals}}>Admin</option>                    <div class="d-flex gap-2">

                        <label class="permission-item">

                            <input type="checkbox" checked>                <option value="Manager" {{#ifEquals role 'Manager'}}selected{{/ifEquals}}>Manager</option>                        <button type="submit" class="btn btn-primary flex-fill">

                            <span>Xem</span>

                        </label>                <option value="User" {{#ifEquals role 'User'}}selected{{/ifEquals}}>User</option>                            <i class="fas fa-search me-2"></i>Tìm kiếm

                        <label class="permission-item">

                            <input type="checkbox" checked>            </select>                        </button>

                            <span>Tạo</span>

                        </label>                        <a href="/users" class="btn btn-outline-secondary">

                        <label class="permission-item">

                            <input type="checkbox" checked>            <select class="filter-select" id="statusFilter" name="status">                            <i class="fas fa-redo"></i>

                            <span>Sửa</span>

                        </label>                <option value="">Tất cả trạng thái</option>                        </a>

                        <label class="permission-item">

                            <input type="checkbox" checked>                <option value="active" {{#ifEquals status 'active'}}selected{{/ifEquals}}>Hoạt động</option>                    </div>

                            <span>Xóa</span>

                        </label>                <option value="inactive" {{#ifEquals status 'inactive'}}selected{{/ifEquals}}>Không hoạt động</option>                </div>

                        <label class="permission-item">

                            <input type="checkbox">                <option value="blocked" {{#ifEquals status 'blocked'}}selected{{/ifEquals}}>Bị khóa</option>            </form>

                            <span>Duyệt</span>

                        </label>            </select>        </div>

                    </div>

                </div>    </div>



                <div class="permission-section">            <select class="filter-select" id="departmentFilter" name="department">

                    <div class="permission-section-header">

                        <i class="fas fa-file-alt"></i>                <option value="">Tất cả phòng ban</option>    <!-- Users Table -->

                        <h4>Bài đăng</h4>

                    </div>                {{#each departments}}    <div class="card">

                    <div class="permission-items">

                        <label class="permission-item">                <option value="{{DepartmentID}}">{{Name}}</option>        <div class="card-header">

                            <input type="checkbox" checked>

                            <span>Xem</span>                {{/each}}            <h5 class="card-title mb-0">

                        </label>

                        <label class="permission-item">            </select>                <i class="fas fa-list me-2"></i>

                            <input type="checkbox" checked>

                            <span>Tạo</span>                Danh sách người dùng

                        </label>

                        <label class="permission-item">            <button class="filter-btn" onclick="applyFilters()">            </h5>

                            <input type="checkbox" checked>

                            <span>Sửa</span>                <i class="fas fa-filter"></i>        </div>

                        </label>

                        <label class="permission-item">                Lọc        <div class="card-body">

                            <input type="checkbox" checked>

                            <span>Xóa</span>            </button>            <div class="table-responsive">

                        </label>

                    </div>                <table class="table table-hover align-middle">

                </div>

            <button class="filter-btn" onclick="clearFilters()">                    <thead>

                <div class="permission-section">

                    <div class="permission-section-header">                <i class="fas fa-times"></i>                        <tr>

                        <i class="fas fa-dollar-sign"></i>

                        <h4>Thanh toán</h4>                Xóa bộ lọc                            <th>Người dùng</th>

                    </div>

                    <div class="permission-items">            </button>                            <th>Email</th>

                        <label class="permission-item">

                            <input type="checkbox" checked>        </div>                            <th>Phòng ban</th>

                            <span>Xem</span>

                        </label>                            <th>Vai trò</th>

                        <label class="permission-item">

                            <input type="checkbox" checked>        <!-- Table -->                            <th>Trạng thái</th>

                            <span>Tạo</span>

                        </label>        {{#if users.length}}                            <th>Ngày tạo</th>

                        <label class="permission-item">

                            <input type="checkbox" checked>        <div class="table-responsive">                            <th>Lần đăng nhập cuối</th>

                            <span>Sửa</span>

                        </label>            <table class="modern-table">                            <th class="text-center">Thao tác</th>

                        <label class="permission-item">

                            <input type="checkbox" checked>                <thead>                        </tr>

                            <span>Xóa</span>

                        </label>                    <tr>                    </thead>

                    </div>

                </div>                        <th style="width: 40px;">                    <tbody>



                <div class="permission-section">                            <input type="checkbox" class="table-checkbox" id="selectAll">                        {{#if users.length}}

                    <div class="permission-section-header">

                        <i class="fas fa-chart-bar"></i>                        </th>                        {{#each users}}

                        <h4>Báo cáo</h4>

                    </div>                        <th style="width: 250px;">Người dùng</th>                        <tr>

                    <div class="permission-items">

                        <label class="permission-item">                        <th style="width: 200px;">Email</th>                            <td>

                            <input type="checkbox" checked>

                            <span>Xem</span>                        <th style="width: 150px;">Phòng ban</th>                                <div class="d-flex align-items-center">

                        </label>

                        <label class="permission-item">                        <th class="text-center" style="width: 120px;">Vai trò</th>                                    <div class="avatar avatar-md me-3">

                            <input type="checkbox" checked>

                            <span>Tạo</span>                        <th class="text-center" style="width: 130px;">Trạng thái</th>                                        {{#if Avatar}}

                        </label>

                        <label class="permission-item">                        <th style="width: 140px;">Ngày tạo</th>                                        <img src="{{Avatar}}" alt="{{UserName}}" class="rounded-circle">

                            <input type="checkbox" checked>

                            <span>Sửa</span>                        <th style="width: 140px;">Đăng nhập cuối</th>                                        {{else}}

                        </label>

                        <label class="permission-item">                        <th class="text-center" style="width: 200px;">Thao tác</th>                                        <div class="avatar-placeholder bg-primary text-white rounded-circle">

                            <input type="checkbox" checked>

                            <span>Xóa</span>                    </tr>                                            {{substring UserName 0 1}}

                        </label>

                    </div>                </thead>                                        </div>

                </div>

                <tbody>                                        {{/if}}

                <div class="permission-section">

                    <div class="permission-section-header">                    {{#each users}}                                    </div>

                        <i class="fas fa-cog"></i>

                        <h4>Cấu hình</h4>                    <tr>                                    <div>

                    </div>

                    <div class="permission-items">                        <td>                                        <div class="fw-semibold">{{UserName}}</div>

                        <label class="permission-item">

                            <input type="checkbox" checked>                            <input type="checkbox" class="table-checkbox" value="{{Id}}">                                        <small class="text-muted">@{{UserName}}</small>

                            <span>Xem</span>

                        </label>                        </td>                                    </div>

                        <label class="permission-item">

                            <input type="checkbox" checked>                        <td>                                </div>

                            <span>Tạo</span>

                        </label>                            <div class="table-cell-icon">                            </td>

                        <label class="permission-item">

                            <input type="checkbox" checked>                                {{#if Avatar}}                            <td>{{Email}}</td>

                            <span>Sửa</span>

                        </label>                                <img src="{{Avatar}}" alt="{{UserName}}"                             <td>

                    </div>

                </div>                                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">                                {{#if DepartmentName}}

            </div>

                                {{else}}                                <span class="badge bg-light text-dark">

            <div class="roles-actions">

                <button class="btn-modern btn-modern-secondary">                                <div style="width: 40px; height: 40px; background: var(--table-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px;">                                    <i class="fas fa-building me-1"></i>{{DepartmentName}}

                    <i class="fas fa-times"></i>

                    Đóng                                    {{substring UserName 0 1}}                                </span>

                </button>

                <button class="btn-modern btn-modern-primary">                                </div>                                {{else}}

                    <i class="fas fa-save"></i>

                    Lưu                                {{/if}}                                <span class="text-muted">Chưa phân</span>

                </button>

            </div>                                <div>                                {{/if}}

        </div>

    </div>                                    <div class="table-cell-name">{{UserName}}</div>                            </td>

</div>

                                    <div class="table-cell-secondary">@{{UserName}}</div>                            <td>

<!-- Add User Modal -->

<div class="modal fade" id="addUserModal" tabindex="-1">                                </div>                                {{#if IsAdmin}}

    <div class="modal-dialog">

        <div class="modal-content modern-modal">                            </div>                                <span class="badge bg-danger">

            <div class="modal-header">

                <h5 class="modal-title">                        </td>                                    <i class="fas fa-user-shield me-1"></i>Admin

                    <i class="fas fa-user-plus"></i>

                    Thêm tài khoản admin                        <td>                                </span>

                </h5>

                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>                            <div class="table-cell-icon">                                {{else}}

            </div>

            <div class="modal-body">                                <i class="fas fa-envelope" style="color: var(--table-text-secondary);"></i>                                <span class="badge bg-primary">

                <form id="addUserForm">

                    <div class="form-group">                                <span class="table-cell-secondary">{{Email}}</span>                                    <i class="fas fa-user me-1"></i>User

                        <label class="form-label">

                            <i class="fas fa-user"></i>                            </div>                                </span>

                            Họ tên <span class="text-danger">*</span>

                        </label>                        </td>                                {{/if}}

                        <input type="text" class="form-control" placeholder="VD: Nguyen Van A" required>

                    </div>                        <td>                            </td>



                    <div class="form-group">                            {{#if DepartmentName}}                            <td>

                        <label class="form-label">

                            <i class="fas fa-envelope"></i>                            <span class="table-status-badge status-info">                                {{#if IsActive}}

                            Email <span class="text-danger">*</span>

                        </label>                                <i class="fas fa-building"></i>                                <span class="badge bg-success">

                        <input type="email" class="form-control" placeholder="VD: abc@example.com" required>

                    </div>                                {{DepartmentName}}                                    <i class="fas fa-check-circle me-1"></i>Hoạt động



                    <div class="form-group">                            </span>                                </span>

                        <label class="form-label">

                            <i class="fas fa-phone"></i>                            {{else}}                                {{else}}

                            Điện thoại

                        </label>                            <span class="table-cell-secondary">Chưa phân</span>                                <span class="badge bg-secondary">

                        <input type="tel" class="form-control" placeholder="VD: 0909 090 999">

                    </div>                            {{/if}}                                    <i class="fas fa-ban me-1"></i>Khóa



                    <div class="form-group">                        </td>                                </span>

                        <label class="form-label">

                            <i class="fas fa-user-shield"></i>                        <td class="text-center">                                {{/if}}

                            Gán Role <span class="text-danger">*</span>

                        </label>                            {{#if IsAdmin}}                            </td>

                        <div class="role-select-grid">

                            <label class="role-select-card">                            <span class="table-status-badge status-danger">                            <td>

                                <input type="radio" name="role" value="owner">

                                <div class="role-select-content">                                <i class="fas fa-user-shield"></i>                                <small>{{formatDate CreatedAt}}</small>

                                    <i class="fas fa-crown"></i>

                                    <span>Chủ cửa hàng</span>                                Admin                            </td>

                                </div>

                            </label>                            </span>                            <td>

                            <label class="role-select-card">

                                <input type="radio" name="role" value="admin">                            {{else}}                                {{#if LastLoginAt}}

                                <div class="role-select-content">

                                    <i class="fas fa-user-shield"></i>                            <span class="table-status-badge status-info">                                <small>{{formatDate LastLoginAt}}</small>

                                    <span>Quản lý</span>

                                </div>                                <i class="fas fa-user"></i>                                {{else}}

                            </label>

                            <label class="role-select-card">                                User                                <span class="text-muted">Chưa đăng nhập</span>

                                <input type="radio" name="role" value="moderator">

                                <div class="role-select-content">                            </span>                                {{/if}}

                                    <i class="fas fa-user-check"></i>

                                    <span>Nhân viên</span>                            {{/if}}                            </td>

                                </div>

                            </label>                        </td>                            <td class="text-center">

                            <label class="role-select-card">

                                <input type="radio" name="role" value="user">                        <td class="text-center">                                <div class="btn-group btn-group-sm">

                                <div class="role-select-content">

                                    <i class="fas fa-user"></i>                            {{#if IsActive}}                                    <button class="btn btn-outline-primary" 

                                    <span>Ứng viên</span>

                                </div>                            <span class="table-status-badge status-success">                                            onclick="viewUser('{{Id}}')" 

                            </label>

                        </div>                                <i class="fas fa-check-circle"></i>                                            title="Xem chi tiết">

                    </div>

                </form>                                Hoạt động                                        <i class="fas fa-eye"></i>

            </div>

            <div class="modal-footer">                            </span>                                    </button>

                <button type="button" class="btn-modern btn-modern-secondary" data-bs-dismiss="modal">

                    <i class="fas fa-times"></i>                            {{else}}                                    <button class="btn btn-outline-warning" 

                    Đóng

                </button>                            <span class="table-status-badge status-warning">                                            onclick="editUser('{{Id}}')" 

                <button type="button" class="btn-modern btn-modern-primary" onclick="submitAddUser()">

                    <i class="fas fa-save"></i>                                <i class="fas fa-ban"></i>                                            title="Chỉnh sửa">

                    Tạo

                </button>                                Khóa                                        <i class="fas fa-edit"></i>

            </div>

        </div>                            </span>                                    </button>

    </div>

</div>                            {{/if}}                                    <button class="btn btn-outline-info" 



<!-- Add Role Modal -->                        </td>                                            onclick="resetPassword('{{Id}}')" 

<div class="modal fade" id="addRoleModal" tabindex="-1">

    <div class="modal-dialog modal-lg">                        <td>                                            title="Đặt lại mật khẩu">

        <div class="modal-content modern-modal">

            <div class="modal-header">                            <span class="table-cell-secondary">{{formatDate CreatedAt}}</span>                                        <i class="fas fa-key"></i>

                <h5 class="modal-title">

                    <i class="fas fa-plus-circle"></i>                        </td>                                    </button>

                    Thêm role

                </h5>                        <td>                                    {{#if IsActive}}

                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>

            </div>                            {{#if LastLoginAt}}                                    <button class="btn btn-outline-danger" 

            <div class="modal-body">

                <form id="addRoleForm">                            <span class="table-cell-secondary">{{formatDate LastLoginAt}}</span>                                            onclick="toggleUserStatus('{{Id}}', false)" 

                    <div class="row">

                        <div class="col-md-6">                            {{else}}                                            title="Khóa tài khoản">

                            <div class="form-group">

                                <label class="form-label">                            <span class="table-cell-secondary">Chưa đăng nhập</span>                                        <i class="fas fa-lock"></i>

                                    Tên role <span class="text-danger">*</span>

                                </label>                            {{/if}}                                    </button>

                                <input type="text" class="form-control" placeholder="Nhập tên role" required>

                            </div>                        </td>                                    {{else}}

                        </div>

                        <div class="col-md-6">                        <td>                                    <button class="btn btn-outline-success" 

                            <div class="form-group">

                                <label class="form-label">                            <div class="table-actions-cell">                                            onclick="toggleUserStatus('{{Id}}', true)" 

                                    Mô tả <span class="text-danger">*</span>

                                </label>                                <button class="table-action-btn action-view" title="Xem chi tiết"                                            title="Mở khóa">

                                <input type="text" class="form-control" placeholder="Tùy chỉnh theo nhu cầu">

                            </div>                                        onclick="viewUser('{{Id}}')">                                        <i class="fas fa-unlock"></i>

                        </div>

                    </div>                                    <i class="fas fa-eye"></i>                                    </button>



                    <div class="form-group">                                </button>                                    {{/if}}

                        <label class="form-label">

                            Tài nguyên                                <button class="table-action-btn action-edit" title="Chỉnh sửa"                                </div>

                        </label>

                        <div class="permission-table">                                        onclick="editUser('{{Id}}')">                            </td>

                            <table class="table table-bordered">

                                <thead>                                    <i class="fas fa-edit"></i>                        </tr>

                                    <tr>

                                        <th>Tài nguyên</th>                                </button>                        {{/each}}

                                        <th class="text-center">Xem</th>

                                        <th class="text-center">Tạo</th>                                <button class="table-action-btn action-key" title="Đặt lại mật khẩu"                        {{else}}

                                        <th class="text-center">Sửa</th>

                                        <th class="text-center">Xóa</th>                                        style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white;"                        <tr>

                                        <th class="text-center">Duyệt</th>

                                        <th class="text-center">Chọn tất cả</th>                                        onclick="resetPassword('{{Id}}')">                            <td colspan="8" class="text-center py-5">

                                    </tr>

                                </thead>                                    <i class="fas fa-key"></i>                                <i class="fas fa-users fa-3x text-muted mb-3 d-block"></i>

                                <tbody>

                                    <tr>                                </button>                                <p class="text-muted">Không tìm thấy người dùng nào</p>

                                        <td><i class="fas fa-users text-primary"></i> Người dùng</td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                {{#if IsActive}}                            </td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                <button class="table-action-btn action-delete" title="Khóa tài khoản"                        </tr>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                        onclick="toggleUserStatus('{{Id}}', false)">                        {{/if}}

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                    </tr>                                    <i class="fas fa-lock"></i>                    </tbody>

                                    <tr>

                                        <td><i class="fas fa-file-alt text-primary"></i> Bài đăng</td>                                </button>                </table>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                {{else}}            </div>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                <button class="table-action-btn action-unlock" title="Mở khóa"

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                        style="background: linear-gradient(135deg, #10B981, #059669); color: white;"            <!-- Pagination -->

                                    </tr>

                                    <tr>                                        onclick="toggleUserStatus('{{Id}}', true)">            {{#if pagination}}

                                        <td><i class="fas fa-dollar-sign text-primary"></i> Thanh toán</td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                    <i class="fas fa-unlock"></i>            <nav class="mt-4">

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                </button>                <ul class="pagination justify-content-center">

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                                {{/if}}                    <li class="page-item {{#if pagination.isFirst}}disabled{{/if}}">

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                    </tr>                            </div>                        <a class="page-link" href="?page={{pagination.prevPage}}">

                                    <tr>

                                        <td><i class="fas fa-chart-bar text-primary"></i> Báo cáo</td>                        </td>                            <i class="fas fa-chevron-left"></i>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                    </tr>                        </a>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                    {{/each}}                    </li>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                </tbody>                    {{#each pagination.pages}}

                                    </tr>

                                    <tr>            </table>                    <li class="page-item {{#if active}}active{{/if}}">

                                        <td><i class="fas fa-cog text-primary"></i> Cấu hình</td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>        </div>                        <a class="page-link" href="?page={{page}}">{{page}}</a>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>                    </li>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>        <!-- Pagination -->                    {{/each}}

                                        <td class="text-center"><input type="checkbox" class="form-check-input"></td>

                                    </tr>        {{#if pagination}}                    <li class="page-item {{#if pagination.isLast}}disabled{{/if}}">

                                </tbody>

                            </table>        <div class="table-pagination">                        <a class="page-link" href="?page={{pagination.nextPage}}">

                        </div>

                    </div>            <div class="pagination-info">                            <i class="fas fa-chevron-right"></i>

                </form>

            </div>                <span>{{#if pagination.total}}{{pagination.total}}{{else}}0{{/if}} người dùng</span>                        </a>

            <div class="modal-footer">

                <button type="button" class="btn-modern btn-modern-secondary" data-bs-dismiss="modal">                <i class="fas fa-sync-alt" onclick="location.reload()"                     </li>

                    <i class="fas fa-times"></i>

                    Đóng                   style="margin-left: 12px; cursor: pointer; color: var(--table-text-secondary);"                 </ul>

                </button>

                <button type="button" class="btn-modern btn-modern-primary" onclick="submitAddRole()">                   title="Làm mới"></i>            </nav>

                    <i class="fas fa-save"></i>

                    Lưu            </div>            {{/if}}

                </button>

            </div>            <div class="pagination-controls">        </div>

        </div>

    </div>                <button class="pagination-btn" {{#if pagination.isFirst}}disabled{{/if}}    </div>

</div>

                        onclick="goToPage({{pagination.prevPage}})"></div>

<script>

// Tab switching                    <i class="fas fa-chevron-left"></i>

document.querySelectorAll('.users-tab-btn').forEach(btn => {

    btn.addEventListener('click', function() {                </button><!-- Add User Modal -->

        const tabId = this.dataset.tab;

                        <div class="modal fade" id="addUserModal" tabindex="-1">

        // Update active tab button

        document.querySelectorAll('.users-tab-btn').forEach(b => b.classList.remove('active'));                {{#each pagination.pages}}    <div class="modal-dialog modal-lg">

        this.classList.add('active');

                        <button class="pagination-btn {{#if active}}active{{/if}}"        <div class="modal-content">

        // Show/hide tab content

        document.querySelectorAll('.tab-content').forEach(content => {                        onclick="goToPage({{page}})">            <div class="modal-header">

            content.classList.remove('active');

        });                    {{page}}                <h5 class="modal-title">

        document.getElementById(tabId + 'Tab').classList.add('active');

    });                </button>                    <i class="fas fa-user-plus me-2"></i>Thêm người dùng mới

});

                {{/each}}                </h5>

// Status filter

document.querySelectorAll('[data-status]').forEach(btn => {                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>

    btn.addEventListener('click', function() {

        document.querySelectorAll('[data-status]').forEach(b => b.classList.remove('active'));                <button class="pagination-btn" {{#if pagination.isLast}}disabled{{/if}}            </div>

        this.classList.add('active');

        // Filter logic here                        onclick="goToPage({{pagination.nextPage}})">            <form id="addUserForm" method="POST" action="/users/add">

    });

});                    <i class="fas fa-chevron-right"></i>                <div class="modal-body">



// Role selection                </button>                    <div class="row g-3">

document.querySelectorAll('.role-item').forEach(item => {

    item.addEventListener('click', function() {                                        <div class="col-md-6">

        document.querySelectorAll('.role-item').forEach(i => i.classList.remove('active'));

        this.classList.add('active');                <select class="pagination-select" id="itemsPerPage" onchange="changePageSize(this.value)">                            <label class="form-label">Tên đăng nhập *</label>

        // Load role permissions here

    });                    <option value="10">10 hàng/trang</option>                            <input type="text" class="form-control" name="username" required>

});

                    <option value="20" selected>20 hàng/trang</option>                        </div>

// Search functionality

document.getElementById('userSearch')?.addEventListener('input', function(e) {                    <option value="50">50 hàng/trang</option>                        <div class="col-md-6">

    const searchTerm = e.target.value.toLowerCase();

    document.querySelectorAll('.modern-table tbody tr').forEach(row => {                </select>                            <label class="form-label">Email *</label>

        const text = row.textContent.toLowerCase();

        row.style.display = text.includes(searchTerm) ? '' : 'none';            </div>                            <input type="email" class="form-control" name="email" required>

    });

});        </div>                        </div>



// CRUD functions        {{/if}}                        <div class="col-md-6">

function editUser(userId) {

    console.log('Edit user:', userId);        {{else}}                            <label class="form-label">Mật khẩu *</label>

    // Open edit modal with user data

}        <div class="table-empty-state">                            <input type="password" class="form-control" name="password" required>



function deleteUser(userId) {            <div class="table-empty-icon">                        </div>

    if (confirm('Bạn có chắc chắn muốn xóa người dùng này?')) {

        console.log('Delete user:', userId);                <i class="fas fa-users"></i>                        <div class="col-md-6">

        // API call to delete user

    }            </div>                            <label class="form-label">Xác nhận mật khẩu *</label>

}

            <div class="table-empty-text">Không tìm thấy người dùng</div>                            <input type="password" class="form-control" name="confirmPassword" required>

function submitAddUser() {

    const form = document.getElementById('addUserForm');            <div class="table-empty-subtext">                        </div>

    if (form.checkValidity()) {

        console.log('Submit add user');                {{#if search}}                        <div class="col-md-6">

        // API call to add user

        bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();                Không có người dùng nào phù hợp với từ khóa "{{search}}"                            <label class="form-label">Họ tên</label>

    }

}                {{else}}                            <input type="text" class="form-control" name="fullName">



function submitAddRole() {                Chưa có người dùng nào trong hệ thống.                        </div>

    const form = document.getElementById('addRoleForm');

    if (form.checkValidity()) {                {{/if}}                        <div class="col-md-6">

        console.log('Submit add role');

        // API call to add role            </div>                            <label class="form-label">Số điện thoại</label>

        bootstrap.Modal.getInstance(document.getElementById('addRoleModal')).hide();

    }        </div>                            <input type="tel" class="form-control" name="phone">

}

        {{/if}}                        </div>

function editCurrentRole() {

    console.log('Edit current role');    </div>                        <div class="col-md-6">

    // Enable editing of permissions

}</div>                            <label class="form-label">Phòng ban</label>

</script>

                            <select class="form-select" name="department">

<!-- Add User Modal -->                                <option value="">-- Chọn phòng ban --</option>

<div class="modal fade" id="addUserModal" tabindex="-1">                                {{#each departments}}

    <div class="modal-dialog modal-lg">                                <option value="{{DepartmentID}}">{{Name}}</option>

        <div class="modal-content">                                {{/each}}

            <div class="modal-header">                            </select>

                <h5 class="modal-title">                        </div>

                    <i class="fas fa-user-plus me-2"></i>Thêm người dùng mới                        <div class="col-md-6">

                </h5>                            <label class="form-label">Vai trò</label>

                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>                            <select class="form-select" name="role">

            </div>                                <option value="User">User</option>

            <form id="addUserForm" method="POST" action="/users/add">                                <option value="Manager">Manager</option>

                <div class="modal-body">                                <option value="Admin">Admin</option>

                    <div class="row g-3">                            </select>

                        <div class="col-md-6">                        </div>

                            <label class="form-label">Tên đăng nhập *</label>                        <div class="col-12">

                            <input type="text" class="form-control" name="username" required>                            <div class="form-check form-switch">

                        </div>                                <input class="form-check-input" type="checkbox" name="isActive" id="isActive" checked>

                        <div class="col-md-6">                                <label class="form-check-label" for="isActive">

                            <label class="form-label">Email *</label>                                    Kích hoạt tài khoản

                            <input type="email" class="form-control" name="email" required>                                </label>

                        </div>                            </div>

                        <div class="col-md-6">                        </div>

                            <label class="form-label">Mật khẩu *</label>                    </div>

                            <input type="password" class="form-control" name="password" required>                </div>

                        </div>                <div class="modal-footer">

                        <div class="col-md-6">                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>

                            <label class="form-label">Xác nhận mật khẩu *</label>                    <button type="submit" class="btn btn-primary">

                            <input type="password" class="form-control" name="confirmPassword" required>                        <i class="fas fa-save me-2"></i>Thêm người dùng

                        </div>                    </button>

                        <div class="col-md-6">                </div>

                            <label class="form-label">Họ tên</label>            </form>

                            <input type="text" class="form-control" name="fullName">        </div>

                        </div>    </div>

                        <div class="col-md-6"></div>

                            <label class="form-label">Số điện thoại</label>

                            <input type="tel" class="form-control" name="phone"><style>

                        </div>.avatar-md {

                        <div class="col-md-6">    width: 40px;

                            <label class="form-label">Phòng ban</label>    height: 40px;

                            <select class="form-select" name="department">}

                                <option value="">-- Chọn phòng ban --</option>

                                {{#each departments}}.avatar-md img {

                                <option value="{{DepartmentID}}">{{Name}}</option>    width: 100%;

                                {{/each}}    height: 100%;

                            </select>    object-fit: cover;

                        </div>}

                        <div class="col-md-6">

                            <label class="form-label">Vai trò</label>.avatar-placeholder {

                            <select class="form-select" name="role">    width: 40px;

                                <option value="User">User</option>    height: 40px;

                                <option value="Manager">Manager</option>    display: flex;

                                <option value="Admin">Admin</option>    align-items: center;

                            </select>    justify-content: center;

                        </div>    font-weight: 600;

                        <div class="col-12">    font-size: 1.1rem;

                            <div class="form-check form-switch">}

                                <input class="form-check-input" type="checkbox" name="isActive" id="isActive" checked>

                                <label class="form-check-label" for="isActive">.stat-card {

                                    Kích hoạt tài khoản    border: none;

                                </label>    border-radius: 12px;

                            </div>    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

                        </div>    transition: all 0.3s ease;

                    </div>}

                </div>

                <div class="modal-footer">.stat-card:hover {

                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>    transform: translateY(-5px);

                    <button type="submit" class="btn btn-primary">    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);

                        <i class="fas fa-save me-2"></i>Thêm người dùng}

                    </button>

                </div>.stat-icon {

            </form>    width: 60px;

        </div>    height: 60px;

    </div>    border-radius: 12px;

</div>    display: flex;

    align-items: center;

<style>    justify-content: center;

.stat-card {    color: white;

    border: none;    font-size: 24px;

    border-radius: 12px;}

    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);</style>

    transition: all 0.3s ease;

}<script>

function viewUser(userId) {

.stat-card:hover {    window.location.href = `/users/${userId}`;

    transform: translateY(-5px);}

    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);

}function editUser(userId) {

    // Open edit modal or redirect to edit page

.stat-icon {    window.location.href = `/users/${userId}/edit`;

    width: 60px;}

    height: 60px;

    border-radius: 12px;function resetPassword(userId) {

    display: flex;    if (confirm('Bạn có chắc chắn muốn đặt lại mật khẩu cho người dùng này?')) {

    align-items: center;        fetch(`/users/${userId}/reset-password`, {

    justify-content: center;            method: 'POST',

    color: white;            headers: {

    font-size: 24px;                'Content-Type': 'application/json',

}            }

</style>        })

        .then(res => res.json())

<script>        .then(data => {

// Filter functions            if (data.success) {

function getCurrentFilters() {                alert('Đã gửi email đặt lại mật khẩu!');

    const params = new URLSearchParams();            } else {

    const search = document.getElementById('tableSearch')?.value;                alert('Lỗi: ' + data.message);

    const role = document.getElementById('roleFilter')?.value;            }

    const status = document.getElementById('statusFilter')?.value;        })

    const department = document.getElementById('departmentFilter')?.value;        .catch(err => {

                console.error(err);

    if (search) params.set('search', search);            alert('Có lỗi xảy ra!');

    if (role) params.set('role', role);        });

    if (status) params.set('status', status);    }

    if (department) params.set('department', department);}

    

    return params;function toggleUserStatus(userId, activate) {

}    const action = activate ? 'mở khóa' : 'khóa';

    if (confirm(`Bạn có chắc chắn muốn ${action} tài khoản này?`)) {

function applyFilters() {        fetch(`/users/${userId}/toggle-status`, {

    const params = getCurrentFilters();            method: 'POST',

    params.set('page', 1);            headers: {

    window.location.search = params.toString();                'Content-Type': 'application/json',

}            },

            body: JSON.stringify({ isActive: activate })

function clearFilters() {        })

    window.location.href = '/users';        .then(res => res.json())

}        .then(data => {

            if (data.success) {

// Search on Enter                location.reload();

document.getElementById('tableSearch')?.addEventListener('keypress', function(e) {            } else {

    if (e.key === 'Enter') applyFilters();                alert('Lỗi: ' + data.message);

});            }

        })

// Auto-submit on filter change        .catch(err => {

document.getElementById('roleFilter')?.addEventListener('change', applyFilters);            console.error(err);

document.getElementById('statusFilter')?.addEventListener('change', applyFilters);            alert('Có lỗi xảy ra!');

document.getElementById('departmentFilter')?.addEventListener('change', applyFilters);        });

    }

// Select all checkbox}

document.getElementById('selectAll')?.addEventListener('change', function(e) {</script>

    const checkboxes = document.querySelectorAll('.modern-table tbody .table-checkbox');
    checkboxes.forEach(cb => cb.checked = e.target.checked);
});

// Pagination
function goToPage(page) {
    const params = getCurrentFilters();
    params.set('page', page);
    window.location.search = params.toString();
}

function changePageSize(size) {
    const params = getCurrentFilters();
    params.set('limit', size);
    params.set('page', 1);
    window.location.search = params.toString();
}

// User actions
function viewUser(userId) {
    window.location.href = `/users/${userId}`;
}

function editUser(userId) {
    window.location.href = `/users/${userId}/edit`;
}

function resetPassword(userId) {
    if (confirm('Bạn có chắc chắn muốn đặt lại mật khẩu cho người dùng này?')) {
        fetch(`/users/${userId}/reset-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert('Đã gửi email đặt lại mật khẩu!');
            } else {
                alert('Lỗi: ' + data.message);
            }
        })
        .catch(err => {
            console.error(err);
            alert('Có lỗi xảy ra!');
        });
    }
}

function toggleUserStatus(userId, activate) {
    const action = activate ? 'mở khóa' : 'khóa';
    if (confirm(`Bạn có chắc chắn muốn ${action} tài khoản này?`)) {
        fetch(`/users/${userId}/toggle-status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ isActive: activate })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Lỗi: ' + data.message);
            }
        })
        .catch(err => {
            console.error(err);
            alert('Có lỗi xảy ra!');
        });
    }
}

function exportUsers() {
    alert('Chức năng xuất Excel đang được phát triển.');
}
</script>
