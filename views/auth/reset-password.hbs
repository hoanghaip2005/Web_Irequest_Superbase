<h3 class='text-center mb-4 fw-bold text-dark'>Đặt lại mật khẩu</h3>
<p class='text-center text-muted mb-4'>
  Nhập mật khẩu mới cho tài khoản của bạn
</p>

{{#if error}}
  <div class='alert alert-danger d-flex align-items-center'>
    <i class='fas fa-exclamation-triangle me-2'></i>
    <span>{{error}}</span>
  </div>
{{/if}}

{{#if success}}
  <div class='alert alert-success d-flex align-items-center'>
    <i class='fas fa-check-circle me-2'></i>
    <span>{{success}}</span>
  </div>
{{/if}}

<form
  action='/auth/reset-password'
  method='POST'
  id='resetPasswordForm'
  novalidate
>
  <input type='hidden' name='token' value='{{token}}' />

  <div class='form-floating mb-3 password-field'>
    <input
      type='password'
      class='form-control'
      id='password'
      name='password'
      placeholder='Password'
      required
      minlength='6'
    />
    <label for='password'>
      <i class='fas fa-lock me-2'></i>Mật khẩu mới
    </label>
    <button type='button' class='password-toggle' title='Hiện/ẩn mật khẩu'>
      <i class='fas fa-eye'></i>
    </button>
    <div class='invalid-feedback'>
      Mật khẩu phải có ít nhất 6 ký tự
    </div>
  </div>

  <div
    class='password-strength mb-3'
    id='passwordStrength'
    style='display: none;'
  >
    <div class='small text-muted mb-1'>Độ mạnh mật khẩu:</div>
    <div class='progress' style='height: 4px;'>
      <div class='progress-bar' role='progressbar' style='width: 0%'></div>
    </div>
    <small class='strength-text text-muted'>Nhập mật khẩu</small>
  </div>

  <div class='form-floating mb-4 password-field'>
    <input
      type='password'
      class='form-control'
      id='confirmPassword'
      name='confirmPassword'
      placeholder='Confirm Password'
      required
    />
    <label for='confirmPassword'>
      <i class='fas fa-lock me-2'></i>Xác nhận mật khẩu
    </label>
    <button type='button' class='password-toggle' title='Hiện/ẩn mật khẩu'>
      <i class='fas fa-eye'></i>
    </button>
    <div class='invalid-feedback'>
      Mật khẩu xác nhận không khớp
    </div>
  </div>

  <div class='password-requirements mb-4'>
    <small class='text-muted'>
      <strong>Yêu cầu mật khẩu:</strong>
    </small>
    <ul class='small text-muted mt-2 mb-0'>
      <li id='req-length' class='requirement'>
        <i class='fas fa-times text-danger me-1'></i>
        Ít nhất 6 ký tự
      </li>
      <li id='req-lowercase' class='requirement'>
        <i class='fas fa-times text-danger me-1'></i>
        Chữ thường (a-z)
      </li>
      <li id='req-uppercase' class='requirement'>
        <i class='fas fa-times text-danger me-1'></i>
        Chữ hoa (A-Z)
      </li>
      <li id='req-number' class='requirement'>
        <i class='fas fa-times text-danger me-1'></i>
        Số (0-9)
      </li>
      <li id='req-special' class='requirement'>
        <i class='fas fa-times text-danger me-1'></i>
        Ký tự đặc biệt (!@#$%^&*)
      </li>
    </ul>
  </div>

  <button type='submit' class='btn btn-auth text-white mb-4' id='submitBtn'>
    <i class='fas fa-key me-2'></i>Đặt lại mật khẩu
  </button>

  <div class='auth-links'>
    <div class='text-center'>
      <a href='/auth/login' class='text-decoration-none'>
        <i class='fas fa-arrow-left me-2'></i>Quay lại đăng nhập
      </a>
    </div>
  </div>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() { const form =
  document.getElementById('resetPasswordForm'); const passwordInput =
  document.getElementById('password'); const confirmPasswordInput =
  document.getElementById('confirmPassword'); const strengthIndicator =
  document.getElementById('passwordStrength'); const submitBtn =
  document.getElementById('submitBtn'); // Password requirements elements const
  requirements = { length: document.getElementById('req-length'), lowercase:
  document.getElementById('req-lowercase'), uppercase:
  document.getElementById('req-uppercase'), number:
  document.getElementById('req-number'), special:
  document.getElementById('req-special') }; // Password strength and
  requirements checker passwordInput.addEventListener('input', function() {
  const password = this.value; // Show/hide strength indicator if
  (password.length > 0) { strengthIndicator.style.display = 'block'; } else {
  strengthIndicator.style.display = 'none'; } // Check requirements
  checkRequirement(requirements.length, password.length >= 6);
  checkRequirement(requirements.lowercase, /[a-z]/.test(password));
  checkRequirement(requirements.uppercase, /[A-Z]/.test(password));
  checkRequirement(requirements.number, /[0-9]/.test(password));
  checkRequirement(requirements.special,
  /[!@#$%^&*(),.?":{}|<>]/.test(password)); // Update strength const strength =
  calculatePasswordStrength(password); updatePasswordStrength(strength); //
  Recheck confirm password if (confirmPasswordInput.value) {
  validateConfirmPassword(); } }); // Confirm password validation
  confirmPasswordInput.addEventListener('input', validateConfirmPassword);
  function validateConfirmPassword() { const password = passwordInput.value;
  const confirmPassword = confirmPasswordInput.value; if (confirmPassword &&
  password !== confirmPassword) { confirmPasswordInput.setCustomValidity('Mật
  khẩu không khớp'); confirmPasswordInput.classList.add('is-invalid');
  confirmPasswordInput.classList.remove('is-valid'); } else {
  confirmPasswordInput.setCustomValidity('');
  confirmPasswordInput.classList.remove('is-invalid'); if (confirmPassword)
  confirmPasswordInput.classList.add('is-valid'); } } function
  checkRequirement(element, isValid) { const icon = element.querySelector('i');
  if (isValid) { icon.className = 'fas fa-check text-success me-1';
  element.classList.add('text-success'); element.classList.remove('text-muted');
  } else { icon.className = 'fas fa-times text-danger me-1';
  element.classList.remove('text-success'); element.classList.add('text-muted');
  } } function calculatePasswordStrength(password) { let strength = 0; if
  (password.length >= 6) strength += 1; if (password.length >= 8) strength += 1;
  if (/[a-z]/.test(password)) strength += 1; if (/[A-Z]/.test(password))
  strength += 1; if (/[0-9]/.test(password)) strength += 1; if
  (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1; return
  Math.min(strength, 4); } function updatePasswordStrength(strength) { const
  progressBar = strengthIndicator.querySelector('.progress-bar'); const
  strengthText = strengthIndicator.querySelector('.strength-text'); const levels
  = [ { width: 0, text: 'Quá yếu', class: 'bg-danger' }, { width: 25, text:
  'Yếu', class: 'bg-danger' }, { width: 50, text: 'Trung bình', class:
  'bg-warning' }, { width: 75, text: 'Mạnh', class: 'bg-info' }, { width: 100,
  text: 'Rất mạnh', class: 'bg-success' } ]; const level = levels[strength] ||
  levels[0]; progressBar.style.width = level.width + '%'; progressBar.className
  = 'progress-bar ' + level.class; strengthText.textContent = level.text;
  strengthText.className = 'strength-text ' + level.class.replace('bg-',
  'text-'); } // Form validation form.addEventListener('submit', function(e) {
  e.preventDefault(); if (!form.checkValidity()) { e.stopPropagation();
  form.classList.add('was-validated'); return; } // Check if passwords match if
  (passwordInput.value !== confirmPasswordInput.value) {
  confirmPasswordInput.setCustomValidity('Mật khẩu không khớp');
  confirmPasswordInput.classList.add('is-invalid'); return; } // Check password
  strength (at least 3/5 requirements) const password = passwordInput.value; let
  metRequirements = 0; if (password.length >= 6) metRequirements++; if
  (/[a-z]/.test(password)) metRequirements++; if (/[A-Z]/.test(password))
  metRequirements++; if (/[0-9]/.test(password)) metRequirements++; if
  (/[!@#$%^&*(),.?":{}|<>]/.test(password)) metRequirements++; if
  (metRequirements < 3) { alert('Mật khẩu quá yếu. Vui lòng đáp ứng ít nhất 3
  yêu cầu bảo mật.'); return; } // Submit form with loading state const
  originalText = submitBtn.innerHTML; submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xử
  lý...'; this.submit(); }); // Auto focus password input passwordInput.focus();
  });
</script>